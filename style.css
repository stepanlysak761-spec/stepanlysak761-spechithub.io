// Preloader
const lights = document.querySelectorAll('.light');
let lightIdx = 0;
const interval = setInterval(() => {
    if(lightIdx < 5) {
        lights[lightIdx].classList.add('on');
        lightIdx++;
    } else {
        clearInterval(interval);
        setTimeout(() => {
            const loader = document.getElementById('loader');
            if(loader) {
                loader.style.opacity = '0';
                setTimeout(() => loader.remove(), 600);
            }
        }, 1000);
    }
}, 400);

// Radio Typewriter
function playRadio(pilot, text) {
    const display = document.getElementById('radio-display');
    display.innerText = "";
    display.style.color = (pilot === 'TOTO') ? '#00d2be' : '#0f0';
    let i = 0;
    const type = setInterval(() => {
        if(i < text.length) { display.innerText += text.charAt(i); i++; }
        else clearInterval(type);
    }, 50);
}

// Scroll Reveal
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if(entry.isIntersecting) entry.target.classList.add('active');
    });
}, { threshold: 0.1 });
document.querySelectorAll('.section-reveal').forEach(el => observer.observe(el));

// Music Logic
let isPlaying = false;
function toggleMusic() {
    const music = document.getElementById('audio-engine'), btn = document.querySelector('.music-pill');
    if(!isPlaying) { 
        music.src += "&autoplay=1"; 
        btn.innerText = "‚è∏ STOP ATMOSPHERE"; 
        isPlaying = true; 
    }
}
